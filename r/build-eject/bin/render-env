#!/bin/bash

set -e
set -o pipefail

_TMPDIR_GLOBAL=$($ESY_EJECT__ROOT/bin/realpath "/tmp")

if [ -d "$TMPDIR" ]; then
  _TMPDIR=$($ESY_EJECT__ROOT/bin/realpath "$TMPDIR")
else
  _TMPDIR="/does/not/exist"
fi

sed \
  -e "s|\$ESY_EJECT__STORE|$ESY_EJECT__STORE|g"          \
  -e "s|\$ESY_EJECT__SANDBOX|$ESY_EJECT__SANDBOX|g"      \
  -e "s|\$ESY_EJECT__ROOT|$ESY_EJECT__ROOT|g"      \
  -e "s|\$TMPDIR_GLOBAL|$_TMPDIR_GLOBAL|g"   \
  -e "s|\$TMPDIR|$_TMPDIR|g"                 \
  $1 > $2